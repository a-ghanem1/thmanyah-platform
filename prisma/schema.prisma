generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Program {
  id          String    @id @default(uuid())
  title       String
  description String?
  language    String
  status      String
  publishedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  episodes    Episode[]
  categories  ProgramCategory[]

  @@index([status])
  @@index([language])
  @@index([publishedAt])
}

model Episode {
  id              String    @id @default(uuid())
  programId       String
  title           String
  description     String?
  durationSeconds Int
  audioUrl        String?
  publishedAt     DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  program Program @relation(fields: [programId], references: [id])

  @@index([programId])
  @@index([publishedAt])
}

model Category {
  id        String    @id @default(uuid())
  name      String
  slug      String    @unique
  createdAt DateTime  @default(now())

  programs ProgramCategory[]
}

model ProgramCategory {
  programId  String
  categoryId String

  program  Program  @relation(fields: [programId], references: [id])
  category Category @relation(fields: [categoryId], references: [id])

  @@id([programId, categoryId])
}

model User {
  id           String    @id @default(uuid())
  email        String    @unique
  passwordHash String
  isActive     Boolean   @default(true)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  roles UserRole[]
}

model Role {
  id   String @id @default(uuid())
  name String @unique

  users UserRole[]
}

model UserRole {
  userId String
  roleId String

  user User @relation(fields: [userId], references: [id])
  role Role @relation(fields: [roleId], references: [id])

  @@id([userId, roleId])
}

model SearchOutboxEvent {
  id          String            @id @default(uuid())
  type        String
  entityId    String
  payload     Json
  status      SearchOutboxStatus @default(pending)
  attempts    Int               @default(0)
  lastError   String?
  createdAt   DateTime          @default(now())
  processedAt DateTime?

  @@index([status, createdAt])
  @@index([type])
}

enum SearchOutboxStatus {
  pending
  processed
  failed
}
